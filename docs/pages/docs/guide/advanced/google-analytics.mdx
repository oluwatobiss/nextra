import { Steps } from 'nextra/components'

# Google Analytics

This page describes how to configure your Nextra website with Google Analytics (`gtag.js`).

**Note:** This guide assumes you already have a [Google Analytics measurement id](https://support.google.com/analytics/answer/9304153) for your Nextra site.

## Configuration

<Steps>

### Create Logic for Sending Pageview and Events to Google Analytics

Create a `lib/gtag.js` file that exports the following:

```js filename="lib/gtag.js"
export const GA_TRACKING_ID = process.env.NEXT_PUBLIC_GA_ID;

export const pageview = (url) => {
  window.gtag("config", GA_TRACKING_ID, {
    page_path: url,
  });
};

export const event = ({ action, category, label, value }) => {
  window.gtag("event", action, {
    event_category: category,
    event_label: label,
    value: value,
  });
};
```

- `GA_TRACKING_ID`: A reference to your environment variable's Google Analytics measurement id.
- [`pageview`](https://developers.google.com/analytics/devguides/collection/gtagjs/pages): A function that sends a pageview to Google Analytics.
- [`event`](https://developers.google.com/analytics/devguides/collection/gtagjs/events): A function that sends events to Google Analytics.


### Create a Custom App

Add a custom App (`_app.mdx`) to the `pages` directory of your project.

### Send Pageview to Google Analytics

Import the `lib/gtag.js` file. And use the `pageview` function to send pageviews to Google Analytics whenever users navigate to a new page.

```jsx filename="pages/_app.mdx"
import { useEffect } from "react";
import { useRouter } from "next/router";
import * as gtag from "../lib/gtag";

export default function App({ Component, pageProps }) {
  const router = useRouter();
  useEffect(() => {
    const handleRouteChange = (url) => {
      gtag.pageview(url);
    };
    router.events.on("routeChangeComplete", handleRouteChange);
    return () => {
      router.events.off("routeChangeComplete", handleRouteChange);
    };
  }, [router.events]);

return (
<>
  <Component {...pageProps} />
</>
); }
```

### Add Google Tag to your website's `<head>`

Use [`next/head`](https://nextjs.org/docs/pages/api-reference/components/head) to add Google Tag to your website's `<head>` as shown below:

```jsx filename="pages/_app.mdx" {1,20-34}
import Head from "next/head";
import { useEffect } from "react";
import { useRouter } from "next/router";
import * as gtag from "../lib/gtag";

export default function App({ Component, pageProps }) {
  const router = useRouter();
  useEffect(() => {
    const handleRouteChange = (url) => {
      gtag.pageview(url);
    };
    router.events.on("routeChangeComplete", handleRouteChange);
    return () => {
      router.events.off("routeChangeComplete", handleRouteChange);
    };
  }, [router.events]);

return (
<>
  <Head>
    <script
      dangerouslySetInnerHTML={{
        __html: `
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', '${gtag.GA_TRACKING_ID}', {
            page_path: window.location.pathname,
          });
        `,
      }}
    />
  </Head>
  <Component {...pageProps} />
</>
); }
```

### Add Google Analytics to Your App

Use [`next/script`](https://nextjs.org/docs/pages/building-your-application/optimizing/scripts) to add your Google Analytics tracking code to the custom App (`pages/_app.mdx`):

```jsx filename="pages/_app.mdx" {2,36-40}
import Head from "next/head";
import Script from 'next/script'
import { useEffect } from "react";
import { useRouter } from "next/router";
import * as gtag from "../lib/gtag";

export default function App({ Component, pageProps }) {
  const router = useRouter();
  useEffect(() => {
    const handleRouteChange = (url) => {
      gtag.pageview(url);
    };
    router.events.on("routeChangeComplete", handleRouteChange);
    return () => {
      router.events.off("routeChangeComplete", handleRouteChange);
    };
  }, [router.events]);

return (
<>
  <Head>
    <script
      dangerouslySetInnerHTML={{
        __html: `
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', '${gtag.GA_TRACKING_ID}', {
            page_path: window.location.pathname,
          });
        `,
      }}
    />
  </Head>
  {/* Global Site Tag (gtag.js) - Google Analytics */}
  <Script
    strategy="afterInteractive"
    src={`https://www.googletagmanager.com/gtag/js?id=${gtag.GA_TRACKING_ID}`}
  />
  <Component {...pageProps} />
</>
); }
```

### Load Measurement ID into `process.env`

Create a `.env.local` file in your project's root directory. And add your [Google Analytics measurement id](https://support.google.com/analytics/answer/9539598) to it:

```txt filename=".env.local"
NEXT_PUBLIC_GA_ID=G-xxxxxxxxxx
```

**Note:** Replace `G-xxxxxxxxxx` with your measurement id.

### Add Measurement ID to Your Server's Environment Variable

Add your Google Analytics tracking id to [Vercel's environment variable](https://vercel.com/docs/concepts/projects/environment-variables).

### Deploy Your App to Vercel

[Deploy your app](https://vercel.com/docs/concepts/deployments/overview) to start tracking visitors and page views in your app's Google Analytics dashboard.

</Steps>